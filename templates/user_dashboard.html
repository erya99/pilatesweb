{% extends 'base.html' %}
{% block title %}Panel · Pilates Studio{% endblock %}

{% block content %}
{# üst istatistikler #}
<div class="grid md:grid-cols-2 gap-6 mb-6">
  <div class="rounded-[22px] border border-white/55 bg-white/55 backdrop-blur-xl p-6 shadow-[0_20px_80px_-30px_rgba(0,0,0,.25)]">
    <div class="text-sm text-stone-500">Bu ay katıldığınız ders</div>
    <div class="mt-1 text-3xl font-semibold">{{ monthly_attended }}</div>
    <p class="mt-2 text-xs text-stone-500">Tamamlanan seanslar “attended” olarak otomatik işaretlenir.</p>
  </div>
  <div class="rounded-[22px] border border-white/55 bg-white/55 backdrop-blur-xl p-6 shadow-[0_20px_80px_-30px_rgba(0,0,0,.25)]">
    <div class="text-sm text-stone-500">Kalan seans hakkınız</div>
    <div class="mt-1 text-3xl font-semibold">{{ credits_left }}</div>
    <p class="mt-2 text-[12px] text-stone-500">Seans tamamlandıktan sonra krediden 1 düşülür.</p>
  </div>
</div>

<div class="grid md:grid-cols-2 gap-6">
  <!-- Aktif Rezervasyonlar -->
  <div class="rounded-[22px] border border-white/55 bg-white/55 backdrop-blur-xl p-6 shadow-[0_20px_80px_-30px_rgba(0,0,0,.25)]">
    <div class="flex items-center justify-between mb-3">
      <h2 class="font-semibold text-lg">Aktif Rezervasyonlarım</h2>
      <a href="{{ url_for('list_sessions') }}" class="text-sm underline">Tüm seanslar →</a>
    </div>

    <div class="space-y-3">
      {% for r in my_active %}
      <div class="rounded-2xl bg-white/80 ring-1 ring-white/60 shadow-inner p-4 flex items-center justify-between">
        <div>
          <div class="font-medium">
            {{ r.session.date.strftime('%d.%m.%Y') }} · {{ r.session.time.strftime('%H:%M') }}
          </div>
          <div class="text-xs text-stone-500">
            {{ r.session.notes or '—' }}
          </div>
        </div>
        <div class="flex gap-2">
          <form method="post" action="{{ url_for('cancel', reservation_id=r.id) }}">
            <button class="px-3 py-2 rounded-xl bg-gradient-to-r from-pink-300 to-rose-400 text-stone-900 shadow hover:shadow-md transition text-sm">
              İptal Et
            </button>
          </form>
          <a href="{{ url_for('move', reservation_id=r.id) }}"
             class="px-3 py-2 rounded-xl bg-white/80 ring-1 ring-white/60 shadow hover:bg-white transition text-sm">
            Saat Değiştir
          </a>
        </div>
      </div>
      {% else %}
      <div class="text-sm text-stone-500">Aktif rezervasyonunuz yok.</div>
      {% endfor %}
    </div>

    <p class="mt-3 text-[12px] text-stone-500">
      Not: Seans saatinden 24 saat önce iptal sınırı olabilir; geç iptaller için hocanızla iletişime geçin.
    </p>
  </div>

  <!-- Yaklaşan Seanslar -->
  <div class="rounded-[22px] border border-white/55 bg-white/55 backdrop-blur-xl p-6 shadow-[0_20px_80px_-30px_rgba(0,0,0,.25)]">
    <h2 class="font-semibold text-lg mb-3">Yaklaşan Seanslar</h2>
    <div class="space-y-3">
      {% for s in upcoming %}
      <div class="rounded-2xl bg-white/80 ring-1 ring-white/60 shadow-inner p-4 flex items-center justify-between">
        <div>
          <div class="font-medium">
            {{ s.date.strftime('%d.%m.%Y') }} · {{ s.time.strftime('%H:%M') }}
          </div>
          <div class="text-xs text-stone-500">
            Kapasite: {{ s.capacity }} · Kalan: {{ s.spots_left }}
          </div>
        </div>
        <form method="post" action="{{ url_for('reserve', session_id=s.id) }}">
          <button
            class="px-4 py-2 rounded-2xl shadow-lg transition text-sm
                   {% if s.spots_left == 0 %}
                     bg-gray-300 text-gray-500 cursor-not-allowed opacity-70
                   {% else %}
                     bg-gradient-to-r from-rose-300 to-violet-300 hover:shadow-xl
                   {% endif %}"
            {% if s.spots_left == 0 %}disabled{% endif %}>
            {% if s.spots_left == 0 %}Dolu{% else %}Katıl{% endif %}
          </button>
        </form>
      </div>
      {% else %}
      <div class="text-sm text-stone-500">Seans bulunamadı.</div>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}
